# DareGushi Whisper Bot

Bot name: **درگوشی** (`@DareGushi_BOT`)

این پروژه یک ربات تلگرام با قابلیت «نجوا» است که برای اجرا روی **Railway** و با دیتابیس **PostgreSQL** آماده شده است.

## امکانات
- کلمات تریگر گروهی بدون اسلش: `درگوشی`، `نجوا`، `سکرت` (باید روی پیام کاربر ریپلای شوند).
- پیام نجوا فقط با دکمه «🔒 نمایش پیام» به صورت **Alert** برای فرستنده و گیرنده قابل مشاهده است.
- بعد از خواندن، پیام گروهی به «خوانده شد» تغییر می‌کند و دکمه «نمایش مجدد» می‌ماند.
- آمار کل ربات (کاربران/گروه‌ها/تعداد نجوا).
- ارسال/فوروارد هم‌زمان یک بنر یا متن به همه کاربران و گروه‌ها.
- عضویت اجباری در کانال عمومی (پیش‌فرض: `@SLSHEXED`).
- دکمه‌های «افزودن ربات به گروه» و «ارتباط با پشتیبان».

> نکته: هیچ‌کجای پیام‌های کاربری به موضوع گزارش‌ها اشاره نمی‌شود.

## متغیرهای محیطی
```
BOT_TOKEN=توکن_ربات
ADMIN_ID=123456789        # آیدی عددی مالک
DATABASE_URL=postgresql+asyncpg://USER:PASSWORD@HOST:PORT/DBNAME
FORCE_CHANNEL=@SLSHEXED
WEBHOOK_SECRET=یک_رشته_تصادفی
WEBHOOK_BASE=https://YOUR-RAILWAY-APP.up.railway.app
BOT_USERNAME=DareGushi_BOT
BOT_NAME_FA=درگوشی
PENDING_TIMEOUT_MINUTES=5
```

## دیپلوی روی Railway
1. یک پروژه جدید با **Deploy from GitHub** یا **Dockerfile** بسازید.
2. محتوای این فولدر را به یک ریپو بدهید یا مستقیم آپلود کنید.
3. در قسمت **Variables** مقادیر بالا را ست کنید (حتماً `WEBHOOK_BASE` را با دامنه Railway پر کنید).
4. یک Postgres روی Railway بسازید و `DATABASE_URL` را از آن بردارید.
5. پس از اجرا، وبهوک به صورت خودکار ست می‌شود.

## دستورهای ادمین (فقط در خصوصی ربات)
- `آمار` — نمایش آمار کلی.
- `ارسال همگانی` — سپس روی پیام موردنظر Reply کرده و عبارت «تایید ارسال» را بفرستید تا به همه کاربرها و گروه‌ها کپی شود.
- `بازکردن گزارش <group_id> برای <user_id>` — ارسال گزارش‌های همان گروه برای کاربر مشخص.
- `بستن گزارش <group_id> برای <user_id>` — قطع ارسال گزارش‌های همان گروه برای همان کاربر.

## نکات
- اگر کاربر عضو کانال نباشد، در `/start` صفحه عضویت اجباری با دکمه «✅ تایید عضویت» نمایش داده می‌شود.
- برای اضافه‌کردن ربات به گروه، از دکمه «➕ افزودن ربات به گروه» استفاده کنید.
- طول عمر پنجره انتظار برای ارسال متن نجوا در خصوصی، پیش‌فرض ۵ دقیقه است.
```



## اجرای پولینگ
این نسخه به‌صورت **Polling** اجرا می‌شود و نیاز به وبهوک ندارد. در Railway فقط کافیست سرویس را بالا بیاورید؛
`Dockerfile` طوری تنظیم شده که با `python -m src.main` بات را اجرا کند.
