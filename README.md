# Telegram Najva Bot (Persian Whisper) — Railway + PostgreSQL

این پروژه یک ربات «نجوا»ی تلگرامی است که:
- دستور *فارسی بدون /* دارد (مثلاً «نجوا» یا «نجوا ربات» هنگام ریپلای).
- نجوا را از طریق پی‌وی جمع می‌کند و به گیرنده می‌فرستد.
- گزارش هر نجوا را برای مدیر (ADMIN_ID) و مشترک‌های آن گروه ارسال می‌کند.
- مدیریت اشتراک گزارش‌ها با دستورات فارسی در پی‌وی ربات:
  - `بازکردن گزارش <idگروه> برای <idکاربر>`
  - `بستن گزارش <idگروه> برای <idکاربر>`

## استقرار روی Railway
1) در BotFather توکن بگیرید، ربات را به گروه اضافه و **ادمین** کنید (دسترسی Delete لازم است).  
2) در Railway یک **New Project** بسازید و این ریپو/پروژه را Deploy کنید (یا Zip را آپلود کنید).  
3) از **Add Plugin → PostgreSQL** دیتابیس اضافه کنید. Railway متغیر `DATABASE_URL` را اتوماتیک ست می‌کند.  
4) در **Settings → Variables** این‌ها را ست کنید:
   - `BOT_TOKEN`، `BOT_USERNAME` (بدون @)، `ADMIN_ID` (آیدی عددی شما).
   - `DATABASE_URL` (اگر خود Railway ست نکرده بود؛ معمولاً می‌کند).
5) Deploy را اجرا کنید. لاگ‌ها را ببینید تا پیام `Bot is running...` ظاهر شود.

> نکته: این سرویس با **long polling** کار می‌کند و نیازی به پورت ندارد. اگر خواستید وبهوک بگذارید، می‌توانید پورت باز کنید و Nginx/HTTPS تنظیم کنید.

## توسعهٔ محلی
- Python 3.11+
- `cp .env.sample .env` و مقادیر را وارد کنید.
- Postgres لوکال راه بیندازید و `init.sql` را روی دیتابیس اجرا کنید (یا اولین اجرا، برنامه خودش جدول‌ها را می‌سازد).
- `pip install -r requirements.txt`
- `python bot.py`

## ساختار داده
- `pending_tokens`: توکن‌های کوتاه‌عمر برای لینک‌های دیپ‌لینک.
- `waiting_text`: حالت «در انتظار متن نجوا» در پی‌وی فرستنده.
- `subscriptions`: مشترک‌های دریافت گزارش برای هر گروه.

